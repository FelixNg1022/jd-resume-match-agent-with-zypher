<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JobMatch AI</title>
    <link rel="icon" type="image/svg+xml" href="/logo-icon-only.svg">
    <link rel="alternate icon" href="/logo-icon-only.svg">
    <style>
      * { box-sizing: border-box; margin: 0; padding: 0; }
      
      @keyframes gradientShift {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
      }
      
      @keyframes float {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-3px); }
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.1); }
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes slideIn {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      @keyframes textShimmer {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; 
        margin: 0;
        padding: 0;
        background:
          radial-gradient(circle at 15% 20%, rgba(76, 81, 191, 0.55) 0%, rgba(5, 10, 36, 0) 45%),
          radial-gradient(circle at 80% 10%, rgba(59, 130, 246, 0.45) 0%, rgba(5, 10, 36, 0) 45%),
          radial-gradient(circle at 75% 80%, rgba(139, 92, 246, 0.5) 0%, rgba(5, 10, 36, 0) 55%),
          linear-gradient(135deg, #030617 0%, #0c1028 25%, #1a1747 55%, #2b1861 80%, #120b36 100%);
        background-size: 250% 250%;
        animation: gradientShift 8s ease infinite;
        min-height: 100vh;
        max-height: 100vh;
        overflow: hidden;
        color: #e2e8f0;
        position: relative;
        width: 100vw;
      }
      
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background:
          radial-gradient(circle at 20% 30%, rgba(126, 110, 255, 0.35) 0%, transparent 50%),
          radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.25) 0%, transparent 50%);
        opacity: 0.75;
        pointer-events: none;
        z-index: 0;
      }
      
      body::after {
        content: '';
        position: fixed;
        inset: 0;
        background: linear-gradient(120deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.05) 80%);
        mix-blend-mode: screen;
        opacity: 0.25;
        pointer-events: none;
        z-index: 0;
        animation: gradientShift 10s ease-in-out infinite;
      }
      
      .app-container {
        height: 100vh;
        width: 100vw;
        display: flex;
        flex-direction: column;
        padding: 0;
        position: relative;
        z-index: 1;
        overflow: hidden;
      }
      
      .logo-header {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 24px;
        padding: 40px 60px 30px;
        flex-shrink: 0;
        position: relative;
        border-bottom: 1px solid rgba(99, 102, 241, 0.2);
        background: rgba(15, 23, 42, 0.5);
        backdrop-filter: blur(20px);
      }
      
      .logo-icon {
        width: 70px;
        height: 70px;
        flex-shrink: 0;
        opacity: 0.95;
        filter: drop-shadow(0 0 25px rgba(99, 102, 241, 0.8)) drop-shadow(0 0 50px rgba(139, 92, 246, 0.6)) drop-shadow(0 0 75px rgba(96, 165, 250, 0.4));
        animation: float 2s ease-in-out infinite;
      }
      
      h1 { 
        margin: 0;
        background: linear-gradient(135deg, #818cf8 0%, #a78bfa 25%, #60a5fa 50%, #a78bfa 75%, #818cf8 100%);
        background-size: 300% 300%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 3.5em;
        font-weight: 900;
        letter-spacing: -0.02em;
        text-transform: uppercase;
        animation: textShimmer 2s ease-in-out infinite;
        filter: drop-shadow(0 0 10px rgba(99, 102, 241, 0.5)) drop-shadow(0 0 20px rgba(139, 92, 246, 0.3));
        position: relative;
      }
      
      h1::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: shimmer 2s ease-in-out infinite;
      }
      
      @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
      }
      
      .content-area {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden;
        padding: 40px 60px;
        display: flex;
        flex-direction: column;
        gap: 30px;
      }
      
      .content-area::-webkit-scrollbar {
        width: 8px;
      }
      
      .content-area::-webkit-scrollbar-track {
        background: rgba(30, 41, 59, 0.3);
        border-radius: 4px;
      }
      
      .content-area::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.5);
        border-radius: 4px;
      }
      
      .content-area::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.7);
      }
      
      /* State 1: Initial - Resume Input */
      .state-initial {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        gap: 40px;
        animation: fadeIn 0.6s ease-out;
        transition: opacity 0.5s ease, transform 0.5s ease;
      }
      
      .state-initial.fade-out {
        opacity: 0;
        transform: translateY(-40px);
        pointer-events: none;
      }
      
      .resume-input-section {
        width: 100%;
        max-width: 1400px;
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        padding: 60px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      }
      
      .resume-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }
      
      label { 
        display: block; 
        font-weight: 600; 
        margin-bottom: 8px;
        color: #e2e8f0;
        font-size: 0.95em;
      }
      
      .required-marker {
        color: #f87171;
      }
      
      .upload-controls {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      
      .pdf-upload-label {
        margin: 0;
        cursor: pointer;
        padding: 12px 24px;
        background: #6366f1;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        color: white;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        pointer-events: auto;
        user-select: none;
      }
      
      .pdf-upload-label:hover {
        background: #818cf8;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
      }
      
      .pdf-upload-label:active {
        transform: translateY(0);
      }
      
      .pdf-file-name {
        font-size: 0.9em;
        color: #94a3b8;
      }
      
      .pdf-file-name.success {
        color: #34d399;
      }
      
      .pdf-upload-label.loading {
        background: rgba(30, 41, 59, 0.9) !important;
        cursor: not-allowed !important;
      }
      
      textarea { 
        width: 100%; 
        height: 350px;
        margin-bottom: 20px; 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        font-size: 16px;
        padding: 25px;
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 10px;
        resize: vertical;
        transition: all 0.2s ease;
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        color: #e2e8f0;
      }
      
      textarea:focus {
        outline: none;
        border-color: #818cf8;
        background: rgba(15, 23, 42, 0.8);
      }
      
      .start-button {
        padding: 18px 50px;
        background: #6366f1;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .start-button:hover {
        background: #818cf8;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
      }
      
      .start-button:disabled {
        background: #475569;
        cursor: not-allowed;
        transform: none;
      }
      
      /* State 2+: Main Content Area */
      .main-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
        height: 0;
        opacity: 0;
        transform: translateY(40px);
        pointer-events: none;
        overflow: hidden;
        transition: opacity 0.5s ease, transform 0.5s ease, height 0.5s ease;
      }
      
      .main-content.active {
        height: 100%;
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
        overflow: visible;
      }
      
      .results-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
        flex: 1;
        min-height: 0;
      }
      
      .main-analysis-grid {
        display: grid;
        grid-template-columns: 1fr 8px 1fr;
        gap: 0;
        flex: 1;
        min-height: 0;
        position: relative;
      }
      
      .resizer {
        background: rgba(99, 102, 241, 0.2);
        cursor: col-resize;
        width: 8px;
        position: relative;
        transition: background 0.2s ease;
      }
      
      .resizer:hover {
        background: rgba(99, 102, 241, 0.4);
      }
      
      .resizer::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 2px;
        height: 40px;
        background: rgba(99, 102, 241, 0.5);
        border-radius: 1px;
      }
      
      .resume-strength-section {
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(20px);
        border-radius: 12px;
        padding: 30px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        animation: fadeIn 0.6s ease-out;
        overflow-y: auto;
        max-height: 100%;
        height: 100%;
      }
      
      .resume-strength-section::-webkit-scrollbar {
        width: 4px;
      }
      
      .resume-strength-section::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .resume-strength-section::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.3);
        border-radius: 2px;
      }
      
      .resume-strength-section::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.5);
      }
      
      .job-search-container {
        display: flex;
        flex-direction: column;
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(20px);
        border-radius: 12px;
        padding: 30px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        animation: fadeIn 0.6s ease-out 0.3s both;
        min-height: 0;
        flex: 1;
        height: 100%;
        gap: 20px;
      }
      
      .job-search-section {
        flex: 1;
        min-height: 0;
        display: flex;
        flex-direction: column;
      }
      
      .job-results-wrapper {
        flex: 1;
        background: rgba(11, 18, 40, 0.55);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 14px;
        padding: 20px 24px;
        margin-top: 0;
        margin-bottom: 0;
        min-height: 0;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }
      
      .job-search-results-container {
        flex: 0 0 auto;
        margin-bottom: 0;
        max-height: 40vh;
        overflow-y: auto;
      }
      
      .job-search-results-container::-webkit-scrollbar {
        width: 4px;
      }
      
      .job-search-results-container::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .job-search-results-container::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.3);
        border-radius: 2px;
      }
      
      .job-search-results-container::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.5);
      }
      
      #keywordsSection {
        flex: 0 0 auto;
        margin-top: 0;
        padding-top: 20px;
        border-top: 1px solid rgba(99, 102, 241, 0.2);
        width: 100%;
      }
      
      .keywords-section {
        margin-top: 0;
        padding-top: 0;
        width: 100%;
      }
      
      .keywords-section .section-title {
        margin-top: 0;
        margin-bottom: 12px;
        padding-top: 0;
      }
      
      .job-results-wrapper::-webkit-scrollbar {
        width: 4px;
      }
      
      .job-results-wrapper::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .job-results-wrapper::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.3);
        border-radius: 2px;
      }
      
      .job-results-wrapper::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.5);
      }
      
      .action-buttons {
        width: 100%;
      }
      
      .jd-section {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        gap: 40px;
        animation: fadeIn 0.6s ease-out;
      }
      
      .jd-section.active {
        display: flex;
      }
      
      .jd-input-section {
        width: 100%;
        max-width: 1400px;
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(20px);
        border-radius: 16px;
        padding: 60px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      }
      
      .job-search-section::-webkit-scrollbar {
        width: 4px;
      }
      
      .job-search-section::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .job-search-section::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.3);
        border-radius: 2px;
      }
      
      .job-search-section::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.5);
      }
      
      
      .keywords-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
        margin-bottom: 15px;
      }
      
      input[type="text"] {
        width: 100%;
        padding: 12px 16px;
        font-size: 14px;
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 8px;
        transition: all 0.2s ease;
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        color: #e2e8f0;
        font-family: inherit;
      }
      
      input[type="text"]:focus {
        outline: none;
        border-color: #818cf8;
        background: rgba(15, 23, 42, 0.8);
      }
      
      .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
      }
      
      button {
        padding: 12px 24px;
        background: #6366f1;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      button:hover {
        background: #818cf8;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
      }
      
      button:disabled {
        background: #475569;
        cursor: not-allowed;
        transform: none;
      }
      
      .jd-textarea {
        width: 100%;
        height: 350px;
        margin-bottom: 20px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        font-size: 16px;
        padding: 25px;
        border: 1px solid rgba(99, 102, 241, 0.3);
        border-radius: 10px;
        resize: vertical;
        transition: all 0.2s ease;
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        color: #e2e8f0;
      }
      
      .jd-textarea:focus {
        outline: none;
        border-color: #818cf8;
        background: rgba(15, 23, 42, 0.8);
      }
      
      .dual-results {
        display: none;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 20px;
        animation: fadeIn 0.6s ease-out;
        height: 100%;
        min-height: 0;
      }
      
      .dual-results.active {
        display: grid;
      }
      
      .result-panel {
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(20px);
        border-radius: 12px;
        padding: 30px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        overflow-y: auto;
        min-height: 0;
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      
      .result-panel::-webkit-scrollbar {
        width: 4px;
      }
      
      .result-panel::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .result-panel::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.3);
        border-radius: 2px;
      }
      
      .result-panel::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.5);
      }
      
      .dual-results {
        display: none;
        grid-template-columns: 1fr 8px 1fr;
        gap: 0;
        margin-top: 20px;
        min-height: 0;
        flex: 1;
        height: 100%;
      }
      
      .dual-results.active {
        display: grid;
      }
      
      .result-panel::-webkit-scrollbar {
        width: 6px;
      }
      
      .result-panel::-webkit-scrollbar-track {
        background: rgba(30, 41, 59, 0.3);
      }
      
      .result-panel::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.5);
        border-radius: 3px;
      }
      
      .section-title {
        font-weight: 700;
        color: #ffffff;
        margin-bottom: 20px;
        font-size: 1.4em;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      
      .loading {
        color: #cbd5e1;
        font-style: normal;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        padding: 60px 40px;
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        border: 1px solid rgba(99, 102, 241, 0.3);
        min-height: 250px;
        width: 100%;
        text-align: left;
        margin-bottom: 0;
      }
      
      .loading span {
        flex: 1;
        font-size: 1.1em;
        line-height: 1.6;
      }
      
      .spinner {
        width: 48px;
        height: 48px;
        flex-shrink: 0;
        border-radius: 50%;
        border: 4px solid rgba(99, 102, 241, 0.2);
        border-top-color: #818cf8;
        border-right-color: #a78bfa;
        animation: spin 0.8s linear infinite;
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
      }
      
      .error {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
        color: #f87171;
        padding: 16px;
        border-radius: 12px;
        border: 1px solid rgba(239, 68, 68, 0.4);
        backdrop-filter: blur(10px);
        font-weight: 500;
      }
      
      .result-card {
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 24px;
        margin-bottom: 15px;
        border: 1px solid rgba(99, 102, 241, 0.15);
      }
      
      .score {
        font-size: 2.5em;
        font-weight: 800;
        margin: 10px 0;
        letter-spacing: -0.02em;
      }
      
      .score-label {
        color: #94a3b8;
        font-size: 0.9em;
        margin-bottom: 15px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      
      .skills-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
      }
      
      .skill-tag {
        background: linear-gradient(135deg, rgba(5, 150, 105, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%);
        color: #059669;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: 600;
        border: 1px solid rgba(5, 150, 105, 0.4);
        transition: all 0.2s ease;
        display: inline-block;
        box-shadow: 0 2px 8px rgba(5, 150, 105, 0.3);
      }
      
      .skill-tag.missing {
        background: linear-gradient(135deg, rgba(220, 38, 38, 0.2) 0%, rgba(239, 68, 68, 0.2) 100%);
        color: #dc2626;
        border-color: rgba(220, 38, 38, 0.4);
      }
      
      .job-card {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        border: 1px solid rgba(99, 102, 241, 0.3);
      }
      
      .job-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 12px;
      }
      
      .job-title {
        font-size: 1.2em;
        font-weight: 700;
        color: #e2e8f0;
        margin-bottom: 6px;
      }
      
      .job-company {
        color: #94a3b8;
        font-size: 0.9em;
      }
      
      .job-score {
        font-size: 1.4em;
        font-weight: 800;
        padding: 8px 16px;
        border-radius: 12px;
        white-space: nowrap;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(99, 102, 241, 0.3);
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
        color: #a5b4fc;
      }
      
      .job-description {
        color: #cbd5e1;
        font-size: 0.9em;
        line-height: 1.6;
        margin: 12px 0;
      }
      
      .job-url {
        color: #818cf8;
        text-decoration: none;
        font-size: 0.9em;
        font-weight: 600;
        transition: all 0.2s ease;
        display: inline-block;
        margin-top: 10px;
      }
      
      .job-url:hover {
        color: #a78bfa;
        transform: translateX(4px);
      }
      
      .cover-letter-content {
        background: rgba(30, 41, 59, 0.6);
        padding: 24px;
        border-radius: 12px;
        white-space: pre-wrap;
        line-height: 1.8;
        color: #e2e8f0;
        font-family: 'Georgia', serif;
        margin-bottom: 15px;
        max-height: 45vh;
        overflow-y: auto;
      }
      
      #coverLetterResults {
        display: flex;
        flex-direction: column;
        height: 100%;
      }
      
      #coverLetterResults .cover-letter-content {
        flex: 1;
      }
      
      #coverLetterResults button {
        margin-top: 16px;
      }
      
      .cover-letter-content::-webkit-scrollbar {
        width: 6px;
      }
      
      .cover-letter-content::-webkit-scrollbar-track {
        background: rgba(30, 41, 59, 0.3);
      }
      
      .cover-letter-content::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.5);
        border-radius: 3px;
      }
      
      .hidden {
        display: none !important;
      }
      
      /* System Status Bar */
      .system-status {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(20px);
        border-top: 1px solid rgba(99, 102, 241, 0.2);
        padding: 12px 60px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 13px;
        color: #94a3b8;
        z-index: 100;
      }
      
      .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
        box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
      }
      
      .status-text {
        color: #cbd5e1;
        font-weight: 500;
      }
      
    </style>
  </head>
  <body>
    <div class="app-container">
      <!-- Header (Always Visible) -->
      <div class="logo-header">
        <svg width="50" height="50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 80 80" class="logo-icon">
          <defs>
            <linearGradient id="webpageLogoGradient" x1="0%" y1="0%" x2="100%" y2="100%" gradientUnits="userSpaceOnUse">
              <stop offset="0%" style="stop-color:#818cf8;stop-opacity:1" />
              <stop offset="25%" style="stop-color:#a78bfa;stop-opacity:1" />
              <stop offset="50%" style="stop-color:#60a5fa;stop-opacity:1" />
              <stop offset="75%" style="stop-color:#a78bfa;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#818cf8;stop-opacity:1" />
            </linearGradient>
            <filter id="webpageLogoGlow">
              <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
          <g transform="translate(40, 40)">
            <circle cx="0" cy="0" r="32" fill="none" stroke="url(#webpageLogoGradient)" stroke-width="3" opacity="0.8" filter="url(#webpageLogoGlow)"/>
            <circle cx="0" cy="0" r="22" fill="none" stroke="url(#webpageLogoGradient)" stroke-width="2.5" opacity="0.6"/>
            <circle cx="0" cy="0" r="13" fill="none" stroke="url(#webpageLogoGradient)" stroke-width="2" opacity="0.4"/>
            <circle cx="0" cy="0" r="5" fill="url(#webpageLogoGradient)" filter="url(#webpageLogoGlow)"/>
          </g>
        </svg>
        <h1>JobMatch AI</h1>
      </div>
      
      <div class="content-area">
        <!-- State 1: Initial - Resume Input -->
        <div id="stateInitial" class="state-initial">
          <div class="resume-input-section">
            <div style="text-align: center; margin-bottom: 30px;">
              <label for="pdfUpload" class="pdf-upload-label default" style="display: inline-block; position: relative; z-index: 10;">
                üìÑ Upload Your Resume - I'll Take It From Here!
              </label>
              <input type="file" id="pdfUpload" accept=".pdf,.doc,.docx,.txt" style="display: none;">
              <span id="pdfFileName" class="pdf-file-name hidden" style="margin-left: 15px; color: #10b981;"></span>
            </div>
            <textarea id="resume" placeholder="Drag and drop your resume here or paste text below. Supported: PDF (.pdf), Word (.docx, .doc), TXT (.txt)"></textarea>
          </div>
          <button id="startButton" class="start-button">
            üöÄ Let's Get Started! I'm Ready to Help You Find Your Dream Job
          </button>
        </div>
        
        <!-- State 2+: Main Content -->
        <div id="mainContent" class="main-content">
          <div class="results-section">
            <!-- Main Analysis Grid: Strength Analysis (left) + Job Search (right) -->
            <div class="main-analysis-grid">
              <!-- Resume Strength Analysis (Left) -->
              <div id="resumeStrengthSection" class="resume-strength-section hidden">
                <div class="section-title">üìä Resume Strength Analysis</div>
                <div id="resumeStrengthResults"></div>
              </div>
              
              <!-- Resizer -->
              <div class="resizer" id="mainResizer"></div>
              
              <!-- Job Search Container (Right) -->
              <div id="jobSearchContainer" class="job-search-container hidden">
                <div class="section-title">üîç Job Search Results</div>
                <div id="jobSearchLoading" class="loading" style="display: none;">
                  <div class="spinner"></div>
                  <span>üîç I am searching the web to find roles that match your skills and experience. Give me a moment to gather the best opportunities for you.</span>
                </div>
                <div class="job-results-wrapper">
                  <div class="job-search-results-container">
                    <div id="jobSearchResults"></div>
                  </div>
                  <!-- Keywords Section (Below Jobs, inside wrapper) -->
                  <div id="keywordsSection" class="keywords-section">
                    <div class="section-title" style="font-size: 1.1em; margin-bottom: 12px;">üéØ Refine Your Job Search</div>
                    <div class="ai-hint" style="margin-bottom: 15px; padding: 12px; background: rgba(99, 102, 241, 0.15); border-left: 3px solid #818cf8; border-radius: 8px; color: #cbd5e1; font-size: 0.9em;">
                      üí° <strong>AI Tip:</strong> Adding specific keywords helps me find more relevant opportunities tailored to your skills and preferences.
                    </div>
                    <div class="keywords-grid">
                      <div>
                        <label for="roleInput">Job Type / Role</label>
                        <input type="text" id="roleInput" placeholder="e.g., Software Engineer, Data Scientist">
                      </div>
                      <div>
                        <label for="locationInput">Location</label>
                        <input type="text" id="locationInput" placeholder="e.g., San Francisco, CA or Remote">
                      </div>
                      <div>
                        <label for="keywordsInput">Additional Keywords</label>
                        <input type="text" id="keywordsInput" placeholder="e.g., python, kubernetes, startup">
                      </div>
                    </div>
                    <button onclick="searchJobsWithKeywords()" style="width: 100%; margin-top: 10px;">
                      üîç Perfect! Let me find amazing opportunities that match exactly what you're looking for
                    </button>
                  </div>
                </div>
              </div>
      </div>

            <!-- Full Width JD Button -->
            <div class="action-buttons">
              <button id="jdButton" onclick="toggleJDInput()" class="hidden" style="width: 100%;">
                üíº Excited about a specific role? Share the job description with me and I'll dive deep into analyzing your perfect match, then craft a compelling cover letter that showcases your strengths!
              </button>
            </div>
      
            <!-- JD Input Section -->
            <div id="jdSection" class="jd-section">
              <div class="jd-input-section">
                <div style="text-align: center; margin-bottom: 30px;">
                  <h2 style="color: #ffffff; font-size: 2em; margin-bottom: 10px;">üìã Job Description</h2>
                  <p style="color: #94a3b8; font-size: 1.1em;">Paste the job description below and I'll analyze your match and create a personalized cover letter</p>
                </div>
                <textarea id="jdInput" class="jd-textarea" placeholder="Paste the complete job description here... I will analyze your fit and create a personalized cover letter."></textarea>
                <button onclick="processJD()" class="start-button" style="width: 100%; font-size: 18px; padding: 20px;">
                  ‚ú® Let's Do This! Analyze My Match & Create My Perfect Cover Letter
                </button>
              </div>
            </div>
            
            <!-- Dual Results: Analyze Match (left) + Cover Letter (right) -->
            <div id="dualResults" class="dual-results">
              <div class="result-panel">
                <div class="section-title">üìä Analyze Match Results</div>
                <div id="analyzeMatchResults"></div>
              </div>
              <div class="resizer" id="dualResizer"></div>
              <div class="result-panel">
                <div class="section-title">‚úçÔ∏è Generated Cover Letter</div>
                <div id="coverLetterResults"></div>
              </div>
            </div>
        
            <!-- Re-input JD Button (Below Dual Results) -->
            <div id="reinputJDButton" class="action-buttons" style="display: none;">
              <button onclick="resetJDInput()" style="width: 100%;">
                üîÑ Found Another Great Opportunity? I'm Ready to Analyze It for You!
              </button>
              <button onclick="returnToMainResults()" style="width: 100%;">
                üîÅ Want to review your resume strengths or search more jobs? Let's jump back.
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- System Status Bar -->
      <div class="system-status">
        <div class="status-indicator"></div>
        <span class="status-text" id="statusText">Connected to JobMatch AI</span>
      </div>
    </div>

    <script>
      // State management
      const state = {
        currentState: 'initial', // 'initial', 'main'
        resume: '',
        resumeStrengthDone: false,
        jobSearchDone: false,
        keywordsVisible: false,
        jdVisible: false,
        jdProcessed: false
      };
      
      // Utility function
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }
      
      // Update system status
      function updateStatus(message) {
        const statusText = document.getElementById("statusText");
        if (statusText) {
          statusText.textContent = message;
        }
      }
      
      // Handle file upload
      async function handlePDFUpload(event) {
        const fileInput = event.target || document.getElementById("pdfUpload");
        const file = fileInput.files[0];
        if (!file) {
          return;
        }
        
        const allowedTypes = [
          "application/pdf",
          "application/msword",
          "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
          "text/plain"
        ];
        const allowedExtensions = [".pdf", ".doc", ".docx", ".txt"];
        const fileExtension = "." + file.name.toLowerCase().split('.').pop();
        
        if (!allowedTypes.includes(file.type) && !allowedExtensions.includes(fileExtension)) {
          alert("Please upload a PDF, Word (DOC/DOCX), or TXT file.");
          event.target.value = "";
          return;
        }
        
        const resumeTextarea = document.getElementById("resume");
        const fileNameSpan = document.getElementById("pdfFileName");
        const uploadLabel = document.querySelector('label[for="pdfUpload"]');
        
        uploadLabel.textContent = "‚è≥ Processing...";
        uploadLabel.classList.add("loading");
        uploadLabel.classList.remove("default");
          resumeTextarea.disabled = true;
          resumeTextarea.placeholder = "Extracting text from file...";
          updateStatus("Processing file...");
        
        try {
          const formData = new FormData();
          formData.append("pdf", file);
          formData.append("file", file);
          
          const response = await fetch("/upload-pdf", {
            method: "POST",
            body: formData
          });
          
          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Failed to parse file");
          }
          
          const data = await response.json();
          resumeTextarea.value = data.text;
          state.resume = data.text;
          resumeTextarea.disabled = false;
          resumeTextarea.placeholder = "Drag and drop your resume here or paste text below. Supported: PDF (.pdf), Word (.docx, .doc), TXT (.txt)";
          
          fileNameSpan.textContent = `‚úì ${file.name}`;
          fileNameSpan.classList.remove("hidden");
          fileNameSpan.classList.add("success");
          
          // Show success message - keep it permanent
          uploadLabel.textContent = "‚úÖ Upload Successful! Your Resume is Ready";
          uploadLabel.classList.remove("loading");
          uploadLabel.style.background = "#10b981";
          uploadLabel.style.color = "white";
          uploadLabel.classList.add("default");
          event.target.value = "";
          updateStatus("File processed successfully");
        } catch (error) {
          console.error("Error uploading file:", error);
          updateStatus(`Error: ${error.message}`);
          alert(`Error: ${error.message}`);
          
          uploadLabel.textContent = "üìÑ Upload Your Resume - I'll Take It From Here!";
          uploadLabel.classList.remove("loading");
          uploadLabel.classList.add("default");
          resumeTextarea.disabled = false;
          resumeTextarea.placeholder = "Drag and drop your resume here or paste text below. Supported: PDF (.pdf), Word (.docx, .doc), TXT (.txt)";
          fileNameSpan.classList.add("hidden");
          fileNameSpan.classList.remove("success");
          event.target.value = "";
          
          setTimeout(() => {
            updateStatus("Connected to JobMatch AI");
          }, 3000);
        }
      }
      
      // Start JobMatch AI
      async function startJobMatch(event) {
        if (event) {
          event.preventDefault();
          event.stopPropagation();
        }
        try {
          const resumeTextarea = document.getElementById("resume");
          if (!resumeTextarea) {
            console.error("Resume textarea not found");
            alert("Error: Resume input not found. Please refresh the page.");
            return;
          }
          
          const resume = resumeTextarea.value.trim();
        
        if (!resume) {
            resumeTextarea.style.borderColor = "#f87171";
            resumeTextarea.focus();
            updateStatus("Resume required to start");
            alert("ü§ñ I need your resume to get started! Please paste your resume text or upload a file (PDF, Word, or TXT).");
            setTimeout(() => {
              resumeTextarea.style.borderColor = "rgba(99, 102, 241, 0.3)";
              updateStatus("Connected to JobMatch AI");
            }, 3000);
          return;
        }
        
          state.resume = resume;
          state.currentState = 'main';
          
          // Hide initial state
          const stateInitial = document.getElementById("stateInitial");
          const mainContent = document.getElementById("mainContent");
          
          if (!stateInitial || !mainContent) {
            console.error("Required elements not found");
            alert("Error: Page elements not found. Please refresh the page.");
          return;
        }
        
          stateInitial.classList.add("fade-out");
          await new Promise((resolve) => setTimeout(resolve, 350));
          stateInitial.classList.add("hidden");
          mainContent.classList.add("active");
          
          // Show JD button immediately but disabled
          const jdButton = document.getElementById("jdButton");
          if (jdButton) {
            jdButton.classList.remove("hidden");
            jdButton.disabled = true;
            jdButton.style.opacity = "0.5";
            jdButton.style.cursor = "not-allowed";
          }
          
          updateStatus("Analyzing resume and searching for jobs...");
          
          // Auto-run Resume Strength Analysis
          await analyzeResumeStrength();
          
          // Auto-run Job Search (without keywords)
          await searchJobsAuto();
          
          updateStatus("Connected to JobMatch AI");
        } catch (error) {
          console.error("Error in startJobMatch:", error);
          alert(`Error starting JobMatch AI: ${error.message}`);
          updateStatus(`Error: ${error.message}`);
        }
      }
      
      // Resume Strength Analysis
      async function analyzeResumeStrength() {
        const resultsDiv = document.getElementById("resumeStrengthResults");
        const section = document.getElementById("resumeStrengthSection");
        
        section.classList.remove("hidden");
        resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><span>ü§ñ I am analyzing your resume strength, ATS compatibility, and skill diversity...</span></div>';
        
        // Show job search loading indicator
        const jobSearchContainer = document.getElementById("jobSearchContainer");
        const jobSearchLoading = document.getElementById("jobSearchLoading");
        if (jobSearchContainer && jobSearchLoading) {
          jobSearchContainer.classList.remove("hidden");
          jobSearchLoading.style.display = "flex";
        }
        
        try {
          const res = await fetch("/analyze-resume", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ resume: state.resume })
          });
          
          if (!res.ok) {
            throw new Error(`Server error: ${res.status}`);
          }
          
          const data = await res.json();
          
          if (data.error) {
            resultsDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
            updateStatus(`Error: ${data.error}`);
          } else if (data.analysis) {
            displayResumeStrength(data.analysis);
            state.resumeStrengthDone = true;
            if (state.jobSearchDone) {
              showJDButton();
            }
          } else {
            resultsDiv.innerHTML = `<div class="error">Unexpected response format</div>`;
            updateStatus("Unexpected response format");
          }
        } catch (err) {
          resultsDiv.innerHTML = `<div class="error">Error: ${err.message}</div>`;
          updateStatus(`Error: ${err.message}`);
        }
      }
      
      function displayResumeStrength(analysis) {
        const resultsDiv = document.getElementById("resumeStrengthResults");
        
        const overallColor = analysis.overall_score >= 70 ? "#34d399" : analysis.overall_score >= 50 ? "#fbbf24" : "#f87171";
        const atsColor = analysis.ats_score >= 70 ? "#34d399" : analysis.ats_score >= 50 ? "#fbbf24" : "#f87171";
        
        let html = `
          <div class="result-card">
            <div style="text-align: center; margin-bottom: 20px;">
              <div class="score" style="color: ${overallColor};">${analysis.overall_score}/100</div>
              <div class="score-label">Overall Resume Strength</div>
          </div>
          
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
              <div style="text-align: center; padding: 15px; background: rgba(30, 41, 59, 0.5); border-radius: 12px;">
                <div style="font-size: 1.6em; font-weight: 700; color: ${atsColor}; margin-bottom: 5px;">${analysis.ats_score}</div>
                <div style="font-size: 0.9em; color: #94a3b8;">ATS Score</div>
            </div>
              <div style="text-align: center; padding: 15px; background: rgba(30, 41, 59, 0.5); border-radius: 12px;">
                <div style="font-size: 1.6em; font-weight: 700; color: #818cf8; margin-bottom: 5px;">${analysis.skill_diversity_score}</div>
                <div style="font-size: 0.9em; color: #94a3b8;">Skill Diversity</div>
          </div>
            </div>
            
            <div style="margin-bottom: 15px;">
              <div class="section-title" style="font-size: 1em; margin-bottom: 8px;">‚úÖ Strengths</div>
              <ul style="margin: 8px 0; padding-left: 20px; color: #e2e8f0;">
                ${analysis.strengths.map(s => `<li>${escapeHtml(s)}</li>`).join('')}
              </ul>
                </div>
            
            <div style="margin-bottom: 15px;">
              <div class="section-title" style="font-size: 1em; margin-bottom: 8px;">‚ö†Ô∏è Areas for Improvement</div>
              <ul style="margin: 8px 0; padding-left: 20px; color: #e2e8f0;">
                ${analysis.weaknesses.map(w => `<li>${escapeHtml(w)}</li>`).join('')}
              </ul>
                </div>
            
            <div style="margin-bottom: 15px;">
              <div class="section-title" style="font-size: 1em; margin-bottom: 8px;">üí° Improvement Suggestions</div>
              <ul style="margin: 8px 0; padding-left: 20px; color: #e2e8f0; list-style: none;">
                ${analysis.improvement_suggestions.map(s => `<li style="padding: 4px 0;">üí° ${escapeHtml(s)}</li>`).join('')}
                </ul>
              </div>
            
            <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 50%, rgba(96, 165, 250, 0.2) 100%); border-left: 4px solid #818cf8; padding: 16px 20px; border-radius: 12px; color: #e2e8f0;">
              ${escapeHtml(analysis.summary)}
            </div>
          </div>
        `;
        
        resultsDiv.innerHTML = html;
      }
      
      // Auto-run job search (no keywords)
      async function searchJobsAuto() {
        const resultsDiv = document.getElementById("jobSearchResults");
        const jobSearchLoading = document.getElementById("jobSearchLoading");
        const jobResultsWrapper = document.querySelector(".job-results-wrapper");
        
        // Ensure wrapper is visible
        if (jobResultsWrapper) {
          jobResultsWrapper.style.display = "flex";
        }
        
        // Keep loading indicator visible; clear previous results
        if (resultsDiv) {
          resultsDiv.innerHTML = '';
        }
        
        try {
          const res = await fetch("/search-jobs", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              resume: state.resume,
              role: undefined,
              location: undefined,
              keywords: undefined
            })
          });
          
          if (!res.ok) {
            throw new Error(`Server error: ${res.status}`);
          }
          
          const data = await res.json();
          
          // Hide loading indicator when results arrive
          if (jobSearchLoading) {
            jobSearchLoading.style.display = "none";
          }
          
          if (data.error) {
            if (resultsDiv) {
              resultsDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
            }
            updateStatus(`Error: ${data.error}`);
          } else if (data.result) {
            // Ensure wrapper is visible before displaying results
            if (jobResultsWrapper) {
              jobResultsWrapper.style.display = "flex";
            }
            displayJobResults(data.result);
            state.jobSearchDone = true;
            showJDButton();
          } else {
            if (resultsDiv) {
              resultsDiv.innerHTML = `<div class="error">Unexpected response format</div>`;
            }
            updateStatus("Unexpected response format");
          }
        } catch (err) {
          if (jobSearchLoading) {
            jobSearchLoading.style.display = "none";
          }
          if (resultsDiv) {
            resultsDiv.innerHTML = `<div class="error">Error: ${err.message}</div>`;
          }
          updateStatus(`Error: ${err.message}`);
        }
      }
      
      function displayJobResults(result) {
        const out = document.getElementById("jobSearchResults");
        
        if (!result.jobs || result.jobs.length === 0) {
          out.innerHTML = `
            <div class="result-card">
              <p>No jobs found. Try adding keywords to refine your search.</p>
            </div>
          `;
          return;
        }
        
        // Filter out YouTube videos and non-job posting URLs
        const filteredJobs = result.jobs.filter(job => {
          if (!job.url) return false;
          const url = job.url.toLowerCase();
          // Filter out YouTube
          if (url.includes('youtube.com') || url.includes('youtu.be')) return false;
          // Filter out other video platforms
          if (url.includes('vimeo.com') || url.includes('dailymotion.com')) return false;
          // Filter out social media (except LinkedIn which can have job posts)
          if (url.includes('facebook.com') || url.includes('twitter.com') || url.includes('instagram.com')) return false;
          // Filter out Wikipedia and other encyclopedias
          if (url.includes('wikipedia.org')) return false;
          // Filter out news articles (common patterns)
          if (url.match(/\/\d{4}\/\d{2}\/\d{2}\//) || url.includes('/news/') || url.includes('/article/')) return false;
          return true;
        });
        
        if (filteredJobs.length === 0) {
          out.innerHTML = `
            <div class="result-card">
              <p>No valid job postings found. Try adding keywords to refine your search.</p>
            </div>
          `;
          return;
        }
        
        const isMockData = filteredJobs.some(job => !job.url || job.url === "#");
        const mockDataWarning = isMockData ? `
          <div class="result-card" style="background: rgba(254, 243, 199, 0.2); border-color: rgba(245, 158, 11, 0.4);">
            <div style="color: #f59e0b; font-weight: 600; margin-bottom: 8px;">‚ö†Ô∏è Demo Mode</div>
            <p style="color: #fbbf24; font-size: 0.9em;">These are mock job listings. Set TAVILY_API_KEY for real results.</p>
          </div>
        ` : '';
        
        let html = mockDataWarning;
        
        filteredJobs.forEach((job) => {
          const score = job.score || 0;
          let scoreColor = "#f87171";
          if (score >= 70) scoreColor = "#34d399";
          else if (score >= 50) scoreColor = "#fbbf24";
          
          html += `
            <div class="job-card">
              <div class="job-header">
                <div>
                  <div class="job-title">${escapeHtml(job.title)}</div>
                  ${job.company ? `<div class="job-company">${escapeHtml(job.company)}</div>` : ''}
                </div>
                <div class="job-score" style="color: ${scoreColor};">${score}/100</div>
              </div>
              
              <div class="job-description">
                ${escapeHtml(job.description.substring(0, 200))}${job.description.length > 200 ? '...' : ''}
              </div>
              
              ${job.matchDetails ? `
                <div style="margin: 12px 0;">
                  ${job.matchDetails.matched_skills && job.matchDetails.matched_skills.length > 0 ? `
                    <div style="margin-bottom: 8px;">
                      <div class="section-title" style="font-size: 0.95em; margin-bottom: 6px;">‚úÖ Matched Skills (${job.matchDetails.matched_skills.length})</div>
                      <div class="skills-list">
                        ${job.matchDetails.matched_skills.slice(0, 5).map(s => `<span class="skill-tag">${escapeHtml(s)}</span>`).join("")}
                      </div>
                    </div>
                  ` : ''}
                  ${job.matchDetails.missing_skills && job.matchDetails.missing_skills.length > 0 ? `
                    <div>
                      <div class="section-title" style="font-size: 0.95em; margin-bottom: 6px;">‚ùå Missing Skills (${job.matchDetails.missing_skills.length})</div>
                      <div class="skills-list">
                        ${job.matchDetails.missing_skills.slice(0, 5).map(s => `<span class="skill-tag missing">${escapeHtml(s)}</span>`).join("")}
                      </div>
                    </div>
                  ` : ''}
                </div>
              ` : ''}
              
              ${job.url && job.url !== "#" && job.url !== "about:blank" ? `
                <a href="${escapeHtml(job.url)}" target="_blank" class="job-url">üîó View Job Posting ‚Üí</a>
              ` : ''}
            </div>
          `;
        });
        
        out.innerHTML = html;
      }
      
      // Show JD button after both analyses complete
      function showJDButton() {
        const jdButton = document.getElementById("jdButton");
        if (jdButton && state.jobSearchDone) {
          // Enable the button when job search is done
          jdButton.disabled = false;
          jdButton.style.opacity = "1";
          jdButton.style.cursor = "pointer";
        }
      }
      
      // Search jobs with keywords
      async function searchJobsWithKeywords() {
        const roleInput = document.getElementById("roleInput");
        const locationInput = document.getElementById("locationInput");
        const keywordsInput = document.getElementById("keywordsInput");
        const role = roleInput.value.trim();
        const location = locationInput.value.trim();
        const keywords = keywordsInput.value.trim();
        const resultsDiv = document.getElementById("jobSearchResults");
        const jobSearchLoading = document.getElementById("jobSearchLoading");
        const jobResultsWrapper = document.querySelector(".job-results-wrapper");
        
        // Show loading indicator in the wrapper
        if (jobSearchLoading) {
          jobSearchLoading.style.display = "flex";
        }
        if (resultsDiv) {
          resultsDiv.innerHTML = '';
        }
        
        try {
          const res = await fetch("/search-jobs", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              resume: state.resume,
              role: role || undefined,
              location: location || undefined,
              keywords: keywords || undefined
            })
          });
          
          if (!res.ok) {
            throw new Error(`Server error: ${res.status}`);
          }
          
          const data = await res.json();
          
          // Clear input boxes after search
          if (roleInput) roleInput.value = '';
          if (locationInput) locationInput.value = '';
          if (keywordsInput) keywordsInput.value = '';
          
          if (data.error) {
            if (jobSearchLoading) jobSearchLoading.style.display = "none";
            if (resultsDiv) {
              resultsDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
            }
            updateStatus(`Error: ${data.error}`);
          } else if (data.result) {
            if (jobSearchLoading) jobSearchLoading.style.display = "none";
            // Ensure wrapper is visible and results are displayed inside it
            if (jobResultsWrapper) {
              jobResultsWrapper.style.display = "flex";
            }
            displayJobResults(data.result);
            updateStatus("Search completed");
          } else {
            if (jobSearchLoading) jobSearchLoading.style.display = "none";
            if (resultsDiv) {
              resultsDiv.innerHTML = `<div class="error">Unexpected response format</div>`;
            }
            updateStatus("Unexpected response format");
          }
        } catch (err) {
          if (jobSearchLoading) jobSearchLoading.style.display = "none";
          if (resultsDiv) {
            resultsDiv.innerHTML = `<div class="error">Error: ${err.message}</div>`;
          }
          updateStatus(`Error: ${err.message}`);
        }
      }
      
      // Toggle JD input
      function toggleJDInput() {
        // Don't allow toggling if button is disabled
        const button = document.getElementById("jdButton");
        if (button && button.disabled) {
          return;
        }
        
        const section = document.getElementById("jdSection");
        const mainAnalysisGrid = document.querySelector(".main-analysis-grid");
        const dualResults = document.getElementById("dualResults");
        const reinputJDButton = document.getElementById("reinputJDButton");
        
        state.jdVisible = !state.jdVisible;
        
        if (state.jdVisible) {
          if (mainAnalysisGrid && !state.jdProcessed) {
            mainAnalysisGrid.style.display = "none";
          }
          if (dualResults) {
            dualResults.classList.remove("active");
          }
          if (reinputJDButton) {
            reinputJDButton.style.display = "none";
          }
          section.classList.add("active");
          if (button) {
            button.style.display = "none";
          }
          document.getElementById("jdInput").focus();
        } else {
          section.classList.remove("active");
          if (!state.jdProcessed && mainAnalysisGrid) {
            mainAnalysisGrid.style.display = "";
          }
          if (button) {
            button.style.display = "block";
          }
        }
      }
      
      // Reset JD input for new analysis
      function resetJDInput() {
        const dualResults = document.getElementById("dualResults");
        const jdSection = document.getElementById("jdSection");
        const mainAnalysisGrid = document.querySelector(".main-analysis-grid");
        const reinputJDButton = document.getElementById("reinputJDButton");
        
        if (dualResults) {
          dualResults.classList.remove("active");
        }
        if (mainAnalysisGrid) {
          mainAnalysisGrid.style.display = "none";
        }
        
        state.jdVisible = true;
        state.jdProcessed = false;
        jdSection.classList.add("active");
        document.getElementById("jdInput").value = "";
        document.getElementById("jdInput").focus();
        if (reinputJDButton) {
          reinputJDButton.style.display = "none";
        }
      }
      
      function returnToMainResults() {
        const dualResults = document.getElementById("dualResults");
        const jdSection = document.getElementById("jdSection");
        const mainAnalysisGrid = document.querySelector(".main-analysis-grid");
        const jdButton = document.getElementById("jdButton");
        
        if (dualResults) {
          dualResults.classList.remove("active");
        }
        if (mainAnalysisGrid) {
          mainAnalysisGrid.style.display = "grid";
        }
        if (jdSection) {
          jdSection.classList.remove("active");
        }
        if (jdButton) {
          jdButton.style.display = "block";
          jdButton.disabled = false;
          jdButton.style.opacity = "1";
          jdButton.style.cursor = "pointer";
        }
        state.jdVisible = false;
        
        // Hide the bottom buttons to make room for everything else
        const reinputJDButton = document.getElementById("reinputJDButton");
        if (reinputJDButton) {
          reinputJDButton.style.display = "none";
        }
        
        const resultsSection = document.querySelector(".results-section");
        if (resultsSection) {
          resultsSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }
      
      // Process JD and show dual results
      async function processJD() {
        const jd = document.getElementById("jdInput").value.trim();
        const jdTextarea = document.getElementById("jdInput");
        
        if (!jd) {
          jdTextarea.style.borderColor = "#f87171";
          jdTextarea.focus();
          updateStatus("Job description required");
          alert("ü§ñ I need the job description to analyze your fit and generate a cover letter. Please paste the job description above.");
          setTimeout(() => {
            jdTextarea.style.borderColor = "rgba(99, 102, 241, 0.3)";
            updateStatus("Connected to JobMatch AI");
          }, 3000);
          return;
        }
        
        updateStatus("Analyzing match and generating cover letter...");
        
        state.jdProcessed = true;
        
        // Hide JD section and main analysis grid while showing results
        const mainAnalysisGrid = document.querySelector(".main-analysis-grid");
        const jdSection = document.getElementById("jdSection");
        const jdButton = document.getElementById("jdButton");
        const dualResults = document.getElementById("dualResults");
        const reinputJDButton = document.getElementById("reinputJDButton");
        
        if (mainAnalysisGrid) {
          mainAnalysisGrid.style.display = "none";
        }
        jdSection.classList.remove("active");
        if (jdButton) {
          jdButton.style.display = "none";
        }
        
        // Show dual results
        dualResults.classList.add("active");
        
        // Run both analyses in parallel
        await Promise.all([
          analyzeMatch(jd),
          generateCoverLetter(jd)
        ]);
        
        // Show re-input button
        if (reinputJDButton) {
          reinputJDButton.style.display = "block";
        }
        
        updateStatus("Analysis complete");
      }
      
      // Analyze Match
      async function analyzeMatch(jd) {
        const resultsDiv = document.getElementById("analyzeMatchResults");
        
        resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><span>ü§ñ I am analyzing how well your resume matches this job, identifying matched and missing skills...</span></div>';
        
        try {
          const res = await fetch("/analyze", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ jd, resume: state.resume })
          });
          
          if (!res.ok) {
            throw new Error(`Server error: ${res.status}`);
          }
          
          const data = await res.json();
          
          if (data.error) {
            resultsDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
            updateStatus(`Error: ${data.error}`);
          } else if (data.analysis) {
            displayAnalyzeMatch(data.analysis);
          } else {
            resultsDiv.innerHTML = `<div class="error">Unexpected response format</div>`;
            updateStatus("Unexpected response format");
          }
        } catch (err) {
          resultsDiv.innerHTML = `<div class="error">Error: ${err.message}</div>`;
          updateStatus(`Error: ${err.message}`);
        }
      }
      
      function displayAnalyzeMatch(analysis) {
        const out = document.getElementById("analyzeMatchResults");
        
        let scoreColor = "#f87171";
        if (analysis.score >= 70) scoreColor = "#10b981";
        else if (analysis.score >= 50) scoreColor = "#f59e0b";
        
        let html = `
          <div class="result-card">
            <div class="score" style="color: ${scoreColor};">${analysis.score}/100</div>
            <div class="score-label">Fit Score</div>
          </div>
          
          <div class="result-card">
            <div class="section-title" style="font-size: 1em; margin-bottom: 8px;">üìã Summary</div>
            <div style="color: #e2e8f0;">${escapeHtml(analysis.short_summary || "No summary available")}</div>
          </div>
        `;
        
        if (analysis.matched_skills && analysis.matched_skills.length > 0) {
        html += `
            <div class="result-card">
              <div class="section-title" style="font-size: 1em; margin-bottom: 8px;">‚úÖ Matched Skills (${analysis.matched_skills.length})</div>
              <div class="skills-list">
                ${analysis.matched_skills.map(s => `<span class="skill-tag">${escapeHtml(s)}</span>`).join("")}
              </div>
            </div>
          `;
        }
        
        if (analysis.missing_skills && analysis.missing_skills.length > 0) {
          html += `
            <div class="result-card">
              <div class="section-title" style="font-size: 1em; margin-bottom: 8px;">‚ùå Missing Skills (${analysis.missing_skills.length})</div>
              <div class="skills-list">
                ${analysis.missing_skills.map(s => `<span class="skill-tag missing">${escapeHtml(s)}</span>`).join("")}
              </div>
            </div>
          `;
        }
        
        if (analysis.suggestions && analysis.suggestions.length > 0) {
          html += `
            <div class="result-card">
              <div class="section-title" style="font-size: 1em; margin-bottom: 8px;">üí° Suggestions</div>
              <ul style="margin: 8px 0; padding-left: 20px; color: #e2e8f0; list-style: none;">
                ${analysis.suggestions.map(s => `<li style="padding: 4px 0;">üí° ${escapeHtml(s)}</li>`).join("")}
              </ul>
            </div>
          `;
        }
        
        out.innerHTML = html;
      }
      
      // Generate Cover Letter
      async function generateCoverLetter(jd) {
        const resultsDiv = document.getElementById("coverLetterResults");
        
        resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><span>‚úçÔ∏è I am crafting a personalized cover letter that highlights your relevant experience and aligns with this role...</span></div>';
        
        try {
          const res = await fetch("/generate-cover-letter", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ resume: state.resume, jd })
          });
          
          if (!res.ok) {
            throw new Error(`Server error: ${res.status}`);
          }
          
          const data = await res.json();
          
          if (data.error) {
            resultsDiv.innerHTML = `<div class="error">Error: ${data.error}</div>`;
            updateStatus(`Error: ${data.error}`);
          } else if (data.coverLetter) {
            displayCoverLetter(data.coverLetter);
          } else {
            resultsDiv.innerHTML = `<div class="error">Unexpected response format</div>`;
            updateStatus("Unexpected response format");
          }
        } catch (err) {
          resultsDiv.innerHTML = `<div class="error">Error: ${err.message}</div>`;
          updateStatus(`Error: ${err.message}`);
        }
      }
      
      function displayCoverLetter(coverLetter) {
        const resultsDiv = document.getElementById("coverLetterResults");
        
        let html = `
          <div class="cover-letter-content">${escapeHtml(coverLetter)}</div>
          <button onclick="copyCoverLetter(this)" style="width: 100%;">
            üìã Copy Your Cover Letter - Ready to Use!
          </button>
        `;
        
        resultsDiv.innerHTML = html;
      }
      
      function copyCoverLetter(button) {
        const coverLetterDiv = document.getElementById("coverLetterResults").querySelector(".cover-letter-content");
        if (!coverLetterDiv) return;
        
        const coverLetterText = coverLetterDiv.textContent.trim();
        navigator.clipboard.writeText(coverLetterText).then(() => {
          const originalText = button.textContent;
          button.textContent = "üéâ All Set! Your Cover Letter is Copied!";
          button.style.background = "#10b981";
          updateStatus("Cover letter copied to clipboard - ready to paste!");
          setTimeout(() => {
            button.textContent = originalText;
            button.style.background = "";
            updateStatus("Connected to JobMatch AI");
          }, 2000);
        }).catch(err => {
          alert("Oops! I couldn't copy that. Please try again or copy manually.");
        });
      }
      
      // Show JD button after job search is done
      // Initialize event listeners
      function initializeEventListeners() {
        // File upload handler
        const fileInput = document.getElementById("pdfUpload");
        const uploadLabel = document.querySelector('label[for="pdfUpload"]');
        
        if (fileInput) {
          fileInput.addEventListener("change", handlePDFUpload);
        } else {
          console.error("File input not found!");
        }
        
        // Also add click handler to label as backup
        if (uploadLabel) {
          uploadLabel.addEventListener("click", function(e) {
            e.preventDefault();
            if (fileInput) {
              fileInput.click();
            }
          });
        }
        
        // Start button handler
        const startButton = document.getElementById("startButton");
        if (startButton) {
          startButton.addEventListener("click", startJobMatch);
        } else {
          console.error("Start button not found!");
        }
        
        // Update resume in state when textarea changes
        const resumeTextarea = document.getElementById("resume");
        if (resumeTextarea) {
          resumeTextarea.addEventListener("input", function(e) {
            state.resume = e.target.value.trim();
          });
        }
        
        // Initialize resizers after a short delay to ensure DOM is ready
        setTimeout(initializeResizers, 100);
      }
      
      // Resize functionality for side-by-side panels
      function initializeResizers() {
        // Main analysis grid resizer
        const mainResizer = document.getElementById("mainResizer");
        const mainGrid = document.querySelector(".main-analysis-grid");
        
        if (mainResizer && mainGrid) {
          let isResizing = false;
          
          mainResizer.addEventListener("mousedown", (e) => {
            isResizing = true;
            document.body.style.cursor = "col-resize";
            document.body.style.userSelect = "none";
          });
          
          document.addEventListener("mousemove", (e) => {
            if (!isResizing) return;
            
            const gridRect = mainGrid.getBoundingClientRect();
            const newLeftWidth = ((e.clientX - gridRect.left) / gridRect.width) * 100;
            const newRightWidth = 100 - newLeftWidth - (8 / gridRect.width) * 100;
            
            if (newLeftWidth > 20 && newRightWidth > 20) {
              mainGrid.style.gridTemplateColumns = `${newLeftWidth}% 8px ${newRightWidth}%`;
            }
          });
          
          document.addEventListener("mouseup", () => {
            isResizing = false;
            document.body.style.cursor = "";
            document.body.style.userSelect = "";
          });
        }
        
        // Dual results resizer
        const dualResizer = document.getElementById("dualResizer");
        const dualResults = document.getElementById("dualResults");
        
        if (dualResizer && dualResults) {
          let isResizing = false;
          
          dualResizer.addEventListener("mousedown", (e) => {
            isResizing = true;
            document.body.style.cursor = "col-resize";
            document.body.style.userSelect = "none";
          });
          
          document.addEventListener("mousemove", (e) => {
            if (!isResizing) return;
            
            const gridRect = dualResults.getBoundingClientRect();
            const newLeftWidth = ((e.clientX - gridRect.left) / gridRect.width) * 100;
            const newRightWidth = 100 - newLeftWidth - (8 / gridRect.width) * 100;
            
            if (newLeftWidth > 20 && newRightWidth > 20) {
              dualResults.style.gridTemplateColumns = `${newLeftWidth}% 8px ${newRightWidth}%`;
            }
          });
          
          document.addEventListener("mouseup", () => {
            isResizing = false;
            document.body.style.cursor = "";
            document.body.style.userSelect = "";
          });
        }
      }
      
      // Set up listeners when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeEventListeners);
      } else {
        // DOM is already loaded
        initializeEventListeners();
      }
      
      // Show JD button after job search completes
      // Wrap displayJobResults to show JD button after results are displayed
      const originalDisplayJobResults = displayJobResults;
      displayJobResults = function(result) {
        originalDisplayJobResults(result);
        // Show JD button after job search completes (if not already processed)
        if (!state.jdProcessed && state.jobSearchDone) {
          showJDButton();
        }
      };
    </script>
  </body>
</html>
